<%= javascript_include_tag "http://192.168.100.46:9292/faye.js" %>

<div class="container">
	<div class="span6">
		<p class="alert alert-info">
			<%= t('.chat_public_title')%>
		</p>
		
		<ul id="chat_messages" style="height:400px; max-height:400px; overflow:auto">
			<span id="chat_bottom"></span>
		</ul>
	</div>
	<div class="span3">
		<p class="alert alert-info">
			<%= t('.chat_public_list_title')%>
		</p>
	</div>
</div>

<div class="container">
	<div class="span9">
		<form id="new_message_form" class="form-inline well">
			<input type="text" id="message" name="message" class="input-xxlarge">
			<input type="submit" value="<%= t('.send_text') %>" class="btn btn-primary">
		</form>
	</div>
</div>

<script type="text/javascript">
$(function() {
	// Inicializamos el cliente
	var client = new Faye.Client('http://192.168.100.46:9292/faye');
	
	// Suscribimos el cliente
	client.subscribe('/chats/public', function(data) {
	  $('#chat_messages').append('<li>' + data.usr + ": " + data.msg + '</li>');
	});
	
	// Scroll por default
	var scroll_counter = 400;
	
	// Ennviamos un mensaje en el submit
	$('#new_message_form').submit(function() {
		client.publish('/chats/public', { usr: '<%= current_user.email %>', msg: $('#message').val() });
		$('#message').val('');
		
		scroll_counter += 50;
		$('#chat_messages').animate({scrollTop: scroll_counter}, 50);
		
		return false;
	});
});
</script>
